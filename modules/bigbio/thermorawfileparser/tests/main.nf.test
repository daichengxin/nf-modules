nextflow_process {

    name "Test Process THERMORAWFILEPARSER"
    script "../main.nf"
    process "THERMORAWFILEPARSER"
    tag "modules"
    tag "modules_bigbio"
    tag "thermorawfileparser"

    test("Should convert RAW to mzML") {

        when {
            process {
                """
                input[0] = [
                    [ id: 'test', mzml_id: 'test_sample' ],
                    file('http://ftp.ebi.ac.uk/pride-archive/2015/12/PXD001819/UPS1_50amol_R3.raw', checkIfExists: false)
                ]
                """
            }
        }

        then {
            assert process.success
            assert snapshot(process.out.versions).match("versions")
            assert process.out.mzmls_converted[0][1] ==~ /.*\.mzML/
            assert process.out.log.size() == 1
        }
    }

    test("Should convert RAW to mzML - stub") {

        options "-stub"

        when {
            process {
                """
                input[0] = [
                    [ id: 'test', mzml_id: 'test_sample' ],
                    file('http://ftp.ebi.ac.uk/pride-archive/2015/12/PXD001819/UPS1_50amol_R3.raw', checkIfExists: false)
                ]
                """
            }
        }

        then {
            assert process.success
            assert snapshot(process.out).match()
        }
    }
}

